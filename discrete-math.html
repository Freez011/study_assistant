<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ - Study Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
</head>
<body>
    <div class="dashboard">
        <div class="dashboard-header">
            <a href="dashboard.html" class="back-link"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</a>
            <h1>–î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h1>
            <div class="user-info">
                <a href="profile.html" class="profile-link" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: var(--primary); display: flex; align-items: center; justify-content: center;">
                        <img id="profile-avatar" src="" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <i class="fas fa-user-circle" id="default-avatar" style="font-size: 40px; color: white;"></i>
                    </div>
                    <span id="username"></span>
                </a>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="topic-container">
            <!-- –¢–µ–æ—Ä–∏—è (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–µ —Ç–µ–º—ã) -->
            <div class="topic-section">
                <h3><i class="fas fa-book-open"></i> –¢–µ–æ—Ä–∏—è</h3>
                <div id="theory-list"></div>
            </div>

            <!-- –ü—Ä–∞–∫—Ç–∏–∫–∞ (–∑–∞–¥–∞—á–∏) -->
            <div class="topic-section">
                <h3><i class="fas fa-pencil-alt"></i> –ü—Ä–∞–∫—Ç–∏–∫–∞</h3>
                <div id="practice-area">
                    <p id="task-question">–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"</p>
                    <input type="text" id="task-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
                    <div class="practice-buttons">
                        <button id="check-task" class="btn-ripple">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                        <button id="new-task" class="btn-ripple">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
                    </div>
                    <div id="task-result"></div>
                </div>
            </div>

            <!-- –ò–∫–æ–Ω–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
            <div class="topic-section calculator-icon-section">
                <h3><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h3>
                <div class="calculator-icon" id="open-calculator">
                    <i class="fas fa-calculator fa-3x"></i>
                    <p>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</p>
                </div>
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–∞—Å—Ç–æ—è—â–∏–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º -->
            <div id="calculator-modal" class="calculator-modal">
                <div class="calculator-content">
                    <div class="calculator-header">
                        <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h3>
                        <button class="close-calculator">&times;</button>
                    </div>
                    <div class="calculator-body">
                        <div class="calculator-display">
                            <input type="text" id="calc-display" readonly value="0">
                        </div>
                        <div class="calculator-buttons">
                            <button class="calc-btn clear" data-value="C">C</button>
                            <button class="calc-btn" data-value="¬±">¬±</button>
                            <button class="calc-btn" data-value="%">%</button>
                            <button class="calc-btn operator" data-value="/">√∑</button>
                            
                            <button class="calc-btn" data-value="7">7</button>
                            <button class="calc-btn" data-value="8">8</button>
                            <button class="calc-btn" data-value="9">9</button>
                            <button class="calc-btn operator" data-value="*">√ó</button>
                            
                            <button class="calc-btn" data-value="4">4</button>
                            <button class="calc-btn" data-value="5">5</button>
                            <button class="calc-btn" data-value="6">6</button>
                            <button class="calc-btn operator" data-value="-">‚àí</button>
                            
                            <button class="calc-btn" data-value="1">1</button>
                            <button class="calc-btn" data-value="2">2</button>
                            <button class="calc-btn" data-value="3">3</button>
                            <button class="calc-btn operator" data-value="+">+</button>
                            
                            <button class="calc-btn zero" data-value="0">0</button>
                            <button class="calc-btn" data-value=".">.</button>
                            <button class="calc-btn equals" data-value="=">=</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <span>¬© 2026 Study Assistant</span>
            <span>üìû +7 (933) 234-50-04</span>
            <a href="https://t.me/freezqwx" target="_blank" class="telegram-link">
                <i class="fab fa-telegram-plane"></i> @freezqwx
            </a>
        </div>
    </footer>

    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script>
        tippy('[data-tippy-content]', { theme: 'light', arrow: true });
    </script>
    <script src="js/apply-theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/solvers/discrete.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
            const usernameSpan = document.getElementById('username');
            if (profileData.firstName || profileData.lastName) {
                usernameSpan.textContent = `${profileData.firstName || ''} ${profileData.lastName || ''}`.trim();
            } else {
                usernameSpan.textContent = currentUser;
            }

            const avatarImg = document.getElementById('profile-avatar');
            const defaultIcon = document.getElementById('default-avatar');
            if (profileData.avatar) {
                avatarImg.src = profileData.avatar;
                avatarImg.style.display = 'block';
                defaultIcon.style.display = 'none';
            } else {
                avatarImg.style.display = 'none';
                defaultIcon.style.display = 'block';
            }

            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });

            // === –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–æ—Ä–∏–∏ —Å –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–º ===
            fetch('data/theory/discrete.json')
                .then(response => response.json())
                .then(data => {
                    const theoryList = document.getElementById('theory-list');
                    theoryList.innerHTML = data.topics.map((topic, index) => `
                        <div class="theory-item" data-index="${index}">
                            <div class="theory-header">
                                <h4>${topic.title}</h4>
                                <button class="favorite-btn" data-section="discrete" data-title="${topic.title}" data-content="${topic.content}" data-sectionname="–î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞">
                                    <i class="far fa-star"></i>
                                </button>
                            </div>
                            <div class="theory-content" style="display: none;">
                                <p>${topic.content}</p>
                            </div>
                        </div>
                    `).join('');

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ/—Å–∫—Ä—ã—Ç–∏–µ)
                    document.querySelectorAll('.theory-header').forEach(header => {
                        header.addEventListener('click', function(e) {
                            // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ ‚Äì –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º —Ç–µ–º—É
                            if (e.target.closest('.favorite-btn')) return;
                            
                            const theoryItem = this.closest('.theory-item');
                            const content = theoryItem.querySelector('.theory-content');
                            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            content.style.display = content.style.display === 'block' ? 'none' : 'block';
                        });
                    });

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                    document.querySelectorAll('.favorite-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation(); // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ –∫ –∑–∞–≥–æ–ª–æ–≤–∫—É
                            const section = btn.dataset.section;
                            const title = btn.dataset.title;
                            const content = btn.dataset.content;
                            const sectionName = btn.dataset.sectionname;
                            addFavorite(section, title, content, sectionName);
                            btn.innerHTML = '<i class="fas fa-star"></i>';
                        });
                    });
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–∏:', error));

            // –ó–∞–¥–∞—á–∏
            let tasks = [];
            let currentTask = null;
            fetch('data/tasks/discrete.json')
                .then(response => response.json())
                .then(data => {
                    tasks = data.tasks;
                    newTask();
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error));

            function newTask() {
                if (tasks.length === 0) return;
                const randomIndex = Math.floor(Math.random() * tasks.length);
                currentTask = tasks[randomIndex];
                document.getElementById('task-question').textContent = currentTask.question;
                document.getElementById('task-answer').value = '';
                document.getElementById('task-result').textContent = '';
            }
            document.getElementById('new-task').addEventListener('click', newTask);
            document.getElementById('check-task').addEventListener('click', () => {
                const userAnswer = document.getElementById('task-answer').value.trim();
                if (!currentTask) return;
                if (userAnswer === currentTask.answer) {
                    document.getElementById('task-result').textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                } else {
                    document.getElementById('task-result').textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.';
                }
            });

            // --- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ---
            const modal = document.getElementById('calculator-modal');
            const openBtn = document.getElementById('open-calculator');
            const closeBtn = document.querySelector('.close-calculator');
            const display = document.getElementById('calc-display');
            let currentInput = '0';
            let previousInput = '';
            let operation = null;
            let resetDisplay = false;

            openBtn.addEventListener('click', () => {
                modal.classList.add('active');
            });

            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });

            document.querySelectorAll('.calc-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = btn.dataset.value;
                    if (!value) return;

                    if (value === 'C') {
                        currentInput = '0';
                        previousInput = '';
                        operation = null;
                        display.value = currentInput;
                    } else if (value === '¬±') {
                        currentInput = (parseFloat(currentInput) * -1).toString();
                        display.value = currentInput;
                    } else if (value === '%') {
                        currentInput = (parseFloat(currentInput) / 100).toString();
                        display.value = currentInput;
                    } else if (value === '=') {
                        if (operation && previousInput) {
                            const result = calculate(parseFloat(previousInput), parseFloat(currentInput), operation);
                            display.value = result;
                            currentInput = result.toString();
                            previousInput = '';
                            operation = null;
                        }
                    } else if (['+', '-', '*', '/'].includes(value)) {
                        if (operation && previousInput) {
                            const result = calculate(parseFloat(previousInput), parseFloat(currentInput), operation);
                            display.value = result;
                            previousInput = result.toString();
                        } else {
                            previousInput = currentInput;
                        }
                        operation = value;
                        resetDisplay = true;
                    } else {
                        if (resetDisplay) {
                            currentInput = value;
                            resetDisplay = false;
                        } else {
                            if (value === '.' && currentInput.includes('.')) return;
                            currentInput = currentInput === '0' ? value : currentInput + value;
                        }
                        display.value = currentInput;
                    }
                });
            });

            function calculate(a, b, op) {
                switch(op) {
                    case '+': return a + b;
                    case '-': return a - b;
                    case '*': return a * b;
                    case '/': return b !== 0 ? a / b : '–û—à–∏–±–∫–∞';
                    default: return b;
                }
            }
        });
    </script>
</body>
</html>