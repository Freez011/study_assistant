<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏ - Study Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard">
        <div class="dashboard-header">
            <a href="dashboard.html" class="back-link"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</a>
            <h1>–ü–æ–∏—Å–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏</h1>
            <div class="user-info">
                <a href="profile.html" class="profile-link" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: var(--primary); display: flex; align-items: center; justify-content: center;">
                        <img id="profile-avatar" src="" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <i class="fas fa-user-circle" id="default-avatar" style="font-size: 40px; color: white;"></i>
                    </div>
                    <span id="username"></span>
                </a>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="search-container" style="max-width: 800px;">
            <div class="search-box">
                <input type="text" id="wiki-query" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä, '–ò–Ω—Ç–µ–≥—Ä–∞–ª'">
                <button id="wiki-search-btn"><i class="fas fa-search"></i> –ò—Å–∫–∞—Ç—å –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏</button>
            </div>
            <div id="wiki-results" class="search-results">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <span>¬© 2026 Study Assistant</span>
            <span>üìû +7 (933) 234-50-04</span>
            <a href="https://t.me/freezqwx" target="_blank" class="telegram-link">
                <i class="fab fa-telegram-plane"></i> @freezqwx
            </a>
        </div>
    </footer>

    <script src="js/apply-theme.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è –≤ —à–∞–ø–∫—É (–∫–∞–∫ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö)
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
            const usernameSpan = document.getElementById('username');
            if (profileData.firstName || profileData.lastName) {
                usernameSpan.textContent = `${profileData.firstName || ''} ${profileData.lastName || ''}`.trim();
            } else {
                usernameSpan.textContent = currentUser;
            }

            const avatarImg = document.getElementById('profile-avatar');
            const defaultIcon = document.getElementById('default-avatar');
            if (profileData.avatar) {
                avatarImg.src = profileData.avatar;
                avatarImg.style.display = 'block';
                defaultIcon.style.display = 'none';
            } else {
                avatarImg.style.display = 'none';
                defaultIcon.style.display = 'block';
            }

            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });

            // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–∏—Å–∫–∞ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏
            const searchBtn = document.getElementById('wiki-search-btn');
            const queryInput = document.getElementById('wiki-query');
            const resultsDiv = document.getElementById('wiki-results');

            searchBtn.addEventListener('click', performSearch);
            queryInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            async function performSearch() {
                const query = queryInput.value.trim();
                if (!query) return;

                resultsDiv.innerHTML = '<p>‚è≥ –ü–æ–∏—Å–∫...</p>';

                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –í–∏–∫–∏–ø–µ–¥–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–∞—Ç–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    const url = `https://ru.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`;
                    const response = await fetch(url);

                    if (!response.ok) {
                        if (response.status === 404) {
                            resultsDiv.innerHTML = '<p class="error-message">‚ùå –°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å.</p>';
                        } else {
                            resultsDiv.innerHTML = `<p class="error-message">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: ${response.status}</p>`;
                        }
                        return;
                    }

                    const data = await response.json();

                    // –§–æ—Ä–º–∏—Ä—É–µ–º –≤—ã–≤–æ–¥
                    let html = `
                        <div class="result-card">
                            <h4>${data.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                            <p>${data.extract || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                    `;

                    if (data.content_urls?.desktop?.page) {
                        html += `<p><a href="${data.content_urls.desktop.page}" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç—å—é –Ω–∞ –í–∏–∫–∏–ø–µ–¥–∏–∏ ‚Üí</a></p>`;
                    }

                    html += '</div>';
                    resultsDiv.innerHTML = html;

                } catch (error) {
                    console.error(error);
                    resultsDiv.innerHTML = '<p class="error-message">‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –í–∏–∫–∏–ø–µ–¥–∏–∏.</p>';
                }
            }
        });
    </script>
</body>
</html>