<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python - Study Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>
<body>
    <div class="dashboard">
        <div class="dashboard-header">
            <a href="dashboard.html" class="back-link"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</a>
            <h1>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python</h1>
            <div class="user-info">
                <a href="profile.html" class="profile-link" style="display: flex; align-items: center; gap: 10px; text-decoration: none; color: inherit;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; background: var(--primary); display: flex; align-items: center; justify-content: center;">
                        <img id="profile-avatar" src="" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <i class="fas fa-user-circle" id="default-avatar" style="font-size: 40px; color: white;"></i>
                    </div>
                    <span id="username"></span>
                </a>
                <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="topic-container">
            <!-- –¢–µ–æ—Ä–∏—è -->
            <div class="topic-section">
                <h3><i class="fas fa-book-open"></i> –¢–µ–æ—Ä–∏—è</h3>
                <div id="theory-list"></div>
            </div>

            <!-- –ü—Ä–∞–∫—Ç–∏–∫–∞ (–∑–∞–¥–∞—á–∏) -->
            <div class="topic-section">
                <h3><i class="fas fa-pencil-alt"></i> –ü—Ä–∞–∫—Ç–∏–∫–∞</h3>
                <div id="practice-area">
                    <p id="task-question">–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞"</p>
                    <input type="text" id="task-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç (–∫–æ–¥ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç)">
                    <div class="practice-buttons">
                        <button id="check-task" class="btn-ripple">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                        <button id="new-task" class="btn-ripple">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
                    </div>
                    <div id="task-result"></div>
                </div>
            </div>

            <!-- –ò–∫–æ–Ω–∫–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ Python -->
            <div class="topic-section compiler-icon-section">
                <h3><i class="fab fa-python"></i> –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Python</h3>
                <div class="compiler-icon" id="open-compiler">
                    <i class="fab fa-python fa-3x"></i>
                    <p>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä</p>
                </div>
            </div>

            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º Python -->
            <div id="compiler-modal" class="compiler-modal">
                <div class="compiler-content">
                    <div class="compiler-header">
                        <h3><i class="fab fa-python"></i> Python –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä</h3>
                        <button class="close-compiler">&times;</button>
                    </div>
                    <div class="compiler-body">
                        <div class="compiler-editor">
                            <textarea id="python-code" class="python-editor" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ Python...">print("Hello, World!")</textarea>
                        </div>
                        <div class="compiler-controls">
                            <button id="run-python" class="btn-ripple" disabled>üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <span id="compiler-status" class="compiler-status"></span>
                        </div>
                        <div class="compiler-output">
                            <pre id="python-output" class="python-output">–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-content">
            <span>¬© 2026 Study Assistant</span>
            <span>üìû +7 (933) 234-50-04</span>
            <a href="https://t.me/freezqwx" target="_blank" class="telegram-link">
                <i class="fab fa-telegram-plane"></i> @freezqwx
            </a>
        </div>
    </footer>

    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script>
        tippy('[data-tippy-content]', { theme: 'light', arrow: true });
    </script>
    <script src="js/apply-theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/pyodide-loader.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser}`)) || {};
                const usernameSpan = document.getElementById('username');
                if (profileData.firstName || profileData.lastName) {
                    usernameSpan.textContent = `${profileData.firstName || ''} ${profileData.lastName || ''}`.trim();
                } else {
                    usernameSpan.textContent = currentUser;
                }

                const avatarImg = document.getElementById('profile-avatar');
                const defaultIcon = document.getElementById('default-avatar');
                if (profileData.avatar) {
                    avatarImg.src = profileData.avatar;
                    avatarImg.style.display = 'block';
                    defaultIcon.style.display = 'none';
                } else {
                    avatarImg.style.display = 'none';
                    defaultIcon.style.display = 'block';
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–æ—Ä–∏–∏ Python
            fetch('data/theory/programming.json')
                .then(response => response.json())
                .then(data => {
                    const theoryList = document.getElementById('theory-list');
                    theoryList.innerHTML = data.topics.map((topic, index) => `
                        <div class="result-card">
                            <div style="display: flex; justify-content: space-between;">
                                <h4>${topic.title}</h4>
                                <button class="favorite-btn" data-section="programming" data-title="${topic.title}" data-content="${topic.content}" data-sectionname="–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ">
                                    <i class="far fa-star"></i>
                                </button>
                            </div>
                            <p>${topic.content}</p>
                        </div>
                    `).join('');

                    document.querySelectorAll('.favorite-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const section = btn.dataset.section;
                            const title = btn.dataset.title;
                            const content = btn.dataset.content;
                            const sectionName = btn.dataset.sectionname;
                            addFavorite(section, title, content, sectionName);
                            btn.innerHTML = '<i class="fas fa-star"></i>';
                        });
                    });
                });

            // –ó–∞–¥–∞—á–∏ Python
            let tasks = [];
            let currentTask = null;
            fetch('data/tasks/programming.json')
                .then(response => response.json())
                .then(data => {
                    tasks = data.tasks;
                    newTask();
                });

            function newTask() {
                if (tasks.length === 0) return;
                const randomIndex = Math.floor(Math.random() * tasks.length);
                currentTask = tasks[randomIndex];
                document.getElementById('task-question').textContent = currentTask.question;
                document.getElementById('task-answer').value = '';
                document.getElementById('task-result').textContent = '';
            }
            document.getElementById('new-task').addEventListener('click', newTask);
            document.getElementById('check-task').addEventListener('click', () => {
                const userAnswer = document.getElementById('task-answer').value.trim();
                if (!currentTask) return;
                if (userAnswer.toLowerCase() === currentTask.answer.toLowerCase()) {
                    document.getElementById('task-result').textContent = '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                } else {
                    document.getElementById('task-result').textContent = '‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.';
                }
            });

            // --- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Python ---
            const modal = document.getElementById('compiler-modal');
            const openBtn = document.getElementById('open-compiler');
            const closeBtn = document.querySelector('.close-compiler');
            const runBtn = document.getElementById('run-python');
            const codeArea = document.getElementById('python-code');
            const outputArea = document.getElementById('python-output');
            const statusSpan = document.getElementById('compiler-status');

            openBtn.addEventListener('click', () => {
                modal.classList.add('active');
            });

            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });

            // –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ Pyodide
            let pyodideReady = false;
            let pyodide;

            async function loadPyodideAndRun() {
                statusSpan.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ Python...';
                runBtn.disabled = true;
                try {
                    pyodide = await loadPyodide({
                        indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.24.1/full/'
                    });
                    pyodideReady = true;
                    runBtn.disabled = false;
                    statusSpan.textContent = '‚úÖ Python –∑–∞–≥—Ä—É–∂–µ–Ω';
                } catch (err) {
                    statusSpan.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                    console.error(err);
                }
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º Pyodide –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
            openBtn.addEventListener('click', async () => {
                if (!pyodideReady) {
                    await loadPyodideAndRun();
                }
            });

            runBtn.addEventListener('click', async () => {
                if (!pyodideReady) {
                    outputArea.textContent = '‚è≥ Python –µ—â—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...';
                    return;
                }
                const code = codeArea.value;
                outputArea.textContent = '‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...';
                try {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º stdout
                    pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
                    `);
                    await pyodide.runPythonAsync(code);
                    const output = pyodide.runPython('sys.stdout.getvalue()');
                    outputArea.textContent = output || '‚úÖ –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω (–Ω–µ—Ç –≤—ã–≤–æ–¥–∞)';
                } catch (err) {
                    outputArea.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + err.message;
                }
            });
        });
    </script>
</body>
</html>